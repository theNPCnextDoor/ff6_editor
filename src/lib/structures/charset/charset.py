import re

from src.lib.structures import Bytes
from src.lib.misc.exception import NoCandidateException


class Charset:
    def __init__(self, charset: dict[int, str]):
        self.charset = charset

    def get_char(self, value: int):
        return self.charset.get(value, f"<0x{Bytes(value)}>")

    def get_int(self, value: str) -> int:
        string_byte_regex = r"<0x(?P<byte>[0-9A-F]{2})>"
        if match := re.fullmatch(string_byte_regex, value):
            return int(Bytes(match.group("byte")))

        candidates = [k for k, v in self.charset.items() if v == value]
        if len(candidates) == 0:
            raise NoCandidateException(f"No candidate has been found for char '{value}'.")
        return candidates[0]

    def get_bytes(self, value: str) -> bytes:
        return self.get_int(value=value).to_bytes()


MENU_CHARSET = {
    0x80: "A",
    0x81: "B",
    0x82: "C",
    0x83: "D",
    0x84: "E",
    0x85: "F",
    0x86: "G",
    0x87: "H",
    0x88: "I",
    0x89: "J",
    0x8A: "K",
    0x8B: "L",
    0x8C: "M",
    0x8D: "N",
    0x8E: "O",
    0x8F: "P",
    0x90: "Q",
    0x91: "R",
    0x92: "S",
    0x93: "T",
    0x94: "U",
    0x95: "V",
    0x96: "W",
    0x97: "X",
    0x98: "Y",
    0x99: "Z",
    0x9A: "a",
    0x9B: "b",
    0x9C: "c",
    0x9D: "d",
    0x9E: "e",
    0x9F: "f",
    0xA0: "g",
    0xA1: "h",
    0xA2: "i",
    0xA3: "j",
    0xA4: "k",
    0xA5: "l",
    0xA6: "m",
    0xA7: "n",
    0xA8: "o",
    0xA9: "p",
    0xAA: "q",
    0xAB: "r",
    0xAC: "s",
    0xAD: "t",
    0xAE: "u",
    0xAF: "v",
    0xB0: "w",
    0xB1: "x",
    0xB2: "y",
    0xB3: "z",
    0xB4: "0",
    0xB5: "1",
    0xB6: "2",
    0xB7: "3",
    0xB8: "4",
    0xB9: "5",
    0xBA: "6",
    0xBB: "7",
    0xBC: "8",
    0xBD: "9",
    0xBE: "!",
    0xBF: "?",
    0xC0: "/",
    0xC1: ":",
    0xC2: "”",
    0xC3: "'",
    0xC4: "-",
    0xC5: ".",
    0xC6: ",",
    0xC7: "…",
    0xC8: ";",
    0xC9: "#",
    0xCA: "+",
    0xCB: "(",
    0xCC: ")",
    0xCD: "%",
    0xCE: "~",
    0xCF: "<DOTTED PIPE>",
    # 0xD0: " ",
    # 0xD1: " ",
    0xD2: "=",
    0xD3: "¨",
    0xD4: "↑",
    0xD5: "→",
    0xD6: "↙",
    0xD7: "×",
    0xD8: "<KNIFE>",
    0xD9: "<SWORD>",
    0xDA: "<SPEAR>",
    0xDB: "<KATANA>",
    0xDC: "<STAFF>",
    0xDD: "<BRUSH>",
    0xDE: "<SHURIKEN>",
    0xDF: "<SPECIAL>",
    0xE0: "<DART>",
    0xE1: "<CLAW>",
    0xE2: "<SHIELD>",
    0xE3: "<HELMET>",
    0xE4: "<ARMOR>",
    0xE5: "<TOOL>",
    0xE6: "<SCROLL>",
    0xE7: "<RELIC>",
    0xE8: "<WHITE>",
    0xE9: "<BLACK>",
    0xEA: "<GREY>",
    # 0xEB: " ",
    # 0xEC: " ",
    # 0xED: " ",
    # 0xEE: " ",
    # 0xEF: " ",
    0xF0: "<ATB 0>",
    0xF1: "<ATB 1>",
    0xF2: "<ATB 2>",
    0xF3: "<ATB 3>",
    0xF4: "<ATB 4>",
    0xF5: "<ATB 5>",
    0xF6: "<ATB 6>",
    0xF7: "<ATB 7>",
    0xF8: "<ATB 8>",
    0xF9: "<ATB LEFT BORDER>",
    0xFA: "<ATB RIGHT BORDER>",
    # 0xFB: " ",
    # 0xFC: " ",
    # 0xFD: " ",
    # 0xFE: " ",
    0xFF: " ",
}
